--[[
    init.lua
    Created: 08/14/2024 11:18:07
    Description: Autogenerated script file for the map ZoomerBoss.
]]--
-- Commonly included lua functions and data
require 'explorers_of_friending.common'

-- Package name
local ZoomerBoss = {}

-------------------------------
-- Map Callbacks
-------------------------------
---ZoomerBoss.Init(map)
--Engine callback function
function ZoomerBoss.Init(map)
  

end

---ZoomerBoss.Enter(map)
--Engine callback function
function ZoomerBoss.Enter(map)
  if SV.tarro_forest.revisit == true then
    ZoomerBoss.NoBattle()
  elseif SV.tarro_forest.ZoomerDefeated == true then
    ZoomerBoss.PostBattle()
  else
    ZoomerBoss.PreBattle()
  end
end

function ZoomerBoss.NoBattle()
  GAME:CutsceneMode(true)
  local maru = CH("PLAYER")
  local azura = CH("Azura")
  GAME:MoveCamera(180, 200, 1, false)
  GAME:FadeIn(20)

  GROUND:MoveInDirection(maru, Direction.Up, 24, false, 2)
  GROUND:MoveToPosition(maru, 130, 200, false, 2)
  GROUND:MoveInDirection(azura, Direction.Up, 24, false, 2)
  GROUND:MoveToPosition(azura, 220, 200, false, 2)

  UI:ResetSpeaker()
  UI:WaitShowDialogue("Nothing's here.")

  GROUND:MoveToPosition(azura, 186, -50, true, 5)
  GROUND:MoveToPosition(maru, 156, 127, false, 5)

  SV.tarro_forest.dungpoints = SV.tarro_forest.dungpoints + 1
  GAME:CutsceneMode(false)
  GAME:EnterZone("tarro_forest", -1, 1, 0)
end

function ZoomerBoss.PreBattle()

  local maru = CH("PLAYER")
  local zoomer = CH("Zoomer")
  local azura = CH("Azura")
  GAME:CutsceneMode(true)

  UI:WaitShowTitle(GAME:GetCurrentGround().Name:ToLocal(), 20)
  GAME:WaitFrames(30)
  UI:WaitHideTitle(20)

  GAME:MoveCamera(180, 200, 1, false)

  GAME:FadeIn(20)

  GROUND:MoveInDirection(maru, Direction.Up, 24, false, 2)
  GROUND:MoveToPosition(maru, 130, 200, false, 2)
  GROUND:CharAnimateTurn(maru, Direction.Left, 4, true)
  
  local coro1 = TASK:BranchCoroutine(function() 
    UI:SetSpeaker(maru)
    UI:WaitShowDialogue("...")

    UI:SetSpeaker(maru)
    UI:WaitShowDialogue("Nope, not seeing any big apples.")
    UI:SetSpeakerEmotion("Worried")
    end)	
  local coro2 = TASK:BranchCoroutine(function() 
    GROUND:MoveInDirection(azura, Direction.Up, 24, false, 2)
    GROUND:MoveToPosition(azura, 220, 200, false, 2)
    GROUND:CharAnimateTurn(azura, Direction.Right, 4, false)
    end)
  
  TASK:JoinCoroutines({coro1, coro2})
  
  COMMON.FaceEachother("PLAYER", "Azura")
  UI:WaitShowDialogue("Maybe we're in the wrong place...?") 

  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Angry")
  COMMON.CharAngry("Azura")
  UI:WaitShowDialogue("Nuh-uh! Keep looking!")
  UI:WaitShowDialogue("I want my pie!")

  UI:SetSpeaker(maru)
  UI:SetSpeakerEmotion("Stunned")
  GROUND:CharSetEmote(maru, "sweating", 1)
  UI:WaitShowDialogue("Yeesh,[pause=0] yes ma'am.")
  
  UI:SetSpeaker(STRINGS:Format("\\uE040"))
  UI:WaitShowDialogue("A Big Apple, you say??")
  
  local coro01 = TASK:BranchCoroutine(function()
    GROUND:CharAnimateTurn(azura, Direction.Up, 8, false)
    UI:SetSpeaker(azura)
    UI:SetSpeakerEmotion("Inspired")
    UI:WaitShowDialogue("Yes! A Big Apple, I say!")
    UI:WaitShowDialogue("Do you have one!?")
    end)	
  local coro02 = TASK:BranchCoroutine(function()
    GROUND:CharAnimateTurn(maru, Direction.Up, 4, true)
    end)
  
  TASK:JoinCoroutines({coro01, coro02})
  
  UI:SetSpeaker(STRINGS:Format("\\uE040"))
  UI:WaitShowDialogue("Well, I would happen to know where to \nfind one of those. [pause=0]Kekekekeeeee.")
  
  UI:SetSpeaker(maru)
  UI:SetSpeakerEmotion("Worried")
  UI:WaitShowDialogue("Would you like to tell us where, voice \ncoming from nowhere?")
  
  GAME:WaitFrames(40)
  COMMON.FaceEachother("PLAYER", "Azura")
  GAME:WaitFrames(60)
  UI:SetSpeaker(maru)
  UI:SetSpeakerEmotion("Stunned")
  COMMON.CharSweatdrop("PLAYER")
  GROUND:CharAnimateTurn(maru, Direction.Up, 4, true)
  GAME:WaitFrames(5)
  COMMON.CharSweatdrop("Azura")
  GROUND:CharAnimateTurn(azura, Direction.Up, 8, false)
  UI:WaitShowDialogue("The voice is oblivious, it seems.")
  
  UI:SetSpeaker(zoomer)
  GROUND:MoveToPosition(zoomer, 170, 140, false, 4)
  GROUND:CharAnimateTurn(azura, Direction.UpLeft, 4, true)
  GROUND:CharAnimateTurn(maru, Direction.UpRight, 2, false)
  COMMON.CharAngry("Zoomer")
  UI:SetSpeakerEmotion("Angry")
  UI:WaitShowDialogue("Look, okay! [pause=0]This place is impossible!")
  GROUND:CharAnimateTurn(zoomer, Direction.Up, 4, true)
  UI:WaitShowDialogue("I don't...![pause=0] I just cannot right now!")
  GROUND:CharAnimateTurn(zoomer, Direction.UpRight, 4, true)
  UI:WaitShowDialogue("I've been going around everywhere \ntrying to find just one!")
  UI:WaitShowDialogue("So many of you come in here and \njust...[pause=20] aaah!!")
  
  GAME:WaitFrames(70)
  
  COMMON.CharSweatdrop("PLAYER")
  GAME:WaitFrames(20)
  UI:SetSpeaker(maru)
  UI:SetSpeakerEmotion("Stunned")
  UI:WaitShowDialogue("...so...[pause=0] can we go now?")
  
  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Special3")
  GAME:WaitFrames(20)
  UI:WaitShowDialogue("[speed=0.3]...[speed=0.8]hrmm.")
  UI:SetSpeakerEmotion("Normal")
  GROUND:CharAnimateTurn(zoomer, Direction.Down, 2, true)
  UI:WaitShowDialogue("[speed=1.0]How about no.[pause=0] I'm not letting you \ngo until I find a Big Apple first![scroll]Wait your turn!")
  
  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowDialogue("Oh, really? [pause=0]You want to keep me \naway from my pie.")

  GROUND:CharAnimateTurn(zoomer, Direction.DownRight, 2, true)
  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Stunned")
  UI:WaitShowDialogue("Pie...? [pause=70]Wut?")
  
  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Determined")
  UI:WaitShowDialogue("That pie is mine...!")

  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Stunned")
  UI:WaitShowDialogue("...h-huh???")
  
  COMMON.CharAngry("Azura")
  COMMON.CharHop("Azura")
  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Shouting")
  COMMON.CharHop("Azura")
  UI:WaitShowDialogue("THE PIE IS MINE!!!")
  
  GROUND:CharTurnToCharAnimated(maru, azura, 4)
  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Stunned")
  UI:WaitShowTimedDialogue("[speed=0.1]...", 60)
  GROUND:CharAnimateTurn(zoomer, Direction.Down, 2, false)
  GROUND:CharTurnToCharAnimated(maru, zoomer, 4)
  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowTimedDialogue("Anyway, uh, yeah,[pause=30] fight me or I get that apple first.", 40)

  COMMON.BossTransition()
  DUNsection = 1

  GAME:CutsceneMode(false)
  GAME:ContinueDungeon("tarro_forest", 1, 0, 0)

end

function ZoomerBoss.PostBattle()

  local maru = CH("PLAYER")
  local zoomer = CH("Zoomer")
  local azura = CH("Azura")
  GAME:CutsceneMode(true)
  GROUND:CharSetAnim(zoomer, "Sleep", true)
  GAME:MoveCamera(180, 200, 1, false)
  GROUND:TeleportTo(maru, 156, 177, Direction.Up, 0)
  GROUND:TeleportTo(zoomer, 172, 140, Direction.Down, 0)
  GROUND:TeleportTo(azura, 186, 166, Direction.Up, 0)
  
  GAME:FadeIn(20)
  
  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Pain")
  UI:WaitShowDialogue("Urk...[pause=0] why...?")

  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Joyous")
  UI:WaitShowDialogue("Pie![pause=25] Pie![pause=25] Pie!")

  UI:SetSpeaker(maru)
  UI:SetSpeakerEmotion("Pain")
  UI:WaitShowDialogue("I[pause=45] am[pause=10] so[pause=15] sorry.")

  COMMON.FaceEachother("PLAYER", "Teammate1")
  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowDialogue("He'll just have to deal with it.")
  UI:WaitShowDialogue("Come on, Maru! Let's go back for pie!")

  local coro1 = TASK:BranchCoroutine(function() 
    GROUND:MoveToPosition(azura, 186, -50, true, 5)
    end)	
  local coro2 = TASK:BranchCoroutine(function()
    GAME:WaitFrames(25) 
    GROUND:MoveToPosition(maru, 125, 127, false, 1)
    GAME:WaitFrames(10)
    GROUND:CharTurnToCharAnimated(maru, zoomer, 7)
    GAME:WaitFrames(60)
    UI:SetSpeaker(maru)
    UI:SetSpeakerEmotion("Stunned")
    COMMON.CharSweatdrop("PLAYER")
    UI:WaitShowDialogue("Are you okay...?")
    end)
  
  TASK:JoinCoroutines({coro1, coro2})

  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Pain")
  UI:WaitShowDialogue("Yeah...[pause=65] I think...")

  UI:SetSpeaker(maru)
  GROUND:CharAnimateTurn(maru, Direction.Up, 2, false)
  UI:SetSpeakerEmotion("Shouting")
  COMMON.CharSweating("PLAYER")
  UI:WaitShowDialogue("Azura![pause=30] W[emote=Worried]ait for me!")

  GROUND:MoveToPosition(maru, 125, -50, true, 4)
  GAME:WaitFrames(200)
  UI:SetSpeaker(zoomer)
  UI:SetSpeakerEmotion("Dizzy")
  GROUND:CharSetAnim(zoomer, "Hurt", true)
  UI:WaitShowDialogue("...owie...")
  
  GAME:CutsceneMode(false)
  SV.tarro_forest.dungpoints = SV.tarro_forest.dungpoints + 1
  SV.tarro_forest.revisit = true
  GAME:FadeOut(false, 20)
  GAME:EnterZone("tarro_forest", -1, 1, 0)
  outside_enter = 0
end

---ZoomerBoss.Exit(map)
--Engine callback function
function ZoomerBoss.Exit(map)


end

---ZoomerBoss.Update(map)
--Engine callback function
function ZoomerBoss.Update(map)


end

---ZoomerBoss.GameSave(map)
--Engine callback function
function ZoomerBoss.GameSave(map)


end

---ZoomerBoss.GameLoad(map)
--Engine callback function
function ZoomerBoss.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------


return ZoomerBoss

