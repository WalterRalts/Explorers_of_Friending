--[[
    init.lua
    Created: 11/06/2025 23:46:02
    Description: Autogenerated script file for the map DesertNW.
]]--
-- Commonly included lua functions and data
require 'explorers_of_friending.common'

-- Package name
local DesertNW = {}

-------------------------------
-- Map Callbacks
-------------------------------
---DesertNW.Init(map)
--Engine callback function
function DesertNW.Init(map)
  COMMON.RespawnAllies()
  CH("Teammate1").CollisionDisabled = true
  CH("Teammate2").CollisionDisabled = true
  GROUND:TeleportTo(CH("Teammate1"), CH("PLAYER").Position.X, CH("PLAYER").Position.Y, Dir8.DownRight, 0)
  GROUND:TeleportTo(CH("Teammate2"), CH("PLAYER").Position.X, CH("PLAYER").Position.Y, Dir8.UpRight, 0)
  AI:SetCharacterAI(CH("Teammate1"), "origin.ai.ground_partner", CH('PLAYER'), CH("Teammate1").Position)
  AI:SetCharacterAI(CH("Teammate2"), "origin.ai.ground_partner", CH("Teammate1"), CH("Teammate2").Position)
end

---DesertNW.Enter(map)
--Engine callback function
function DesertNW.Enter(map)

  GAME:FadeIn(20)

end

---DesertNW.Exit(map)
--Engine callback function
function DesertNW.Exit(map)


end

---DesertNW.Update(map)
--Engine callback function
function DesertNW.Update(map)
  Partner()
end

---DesertNW.GameSave(map)
--Engine callback function
function DesertNW.GameSave(map)


end

---DesertNW.GameLoad(map)
--Engine callback function
function DesertNW.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------

-- Interactables

local button_order = {2, 1, 3}
local button_choice = {0, 0, 0}
local choice = 1
local solved = false

local function check_answer()
  print(button_order[choice] .. " is aligned to " .. button_choice[choice])
  if choice == 3 then
    solved = true
    for i = 1, 3, 1 do
      if button_choice[i] ~= button_order[i] then
        solved = false
      end
    end
    if solved == true then
      SV.hertz_town.solvedNW = true
      SOUND:StopBGM()
      SOUND:PlayBattleSE("DUN_SunnyDay")
      UI:ResetSpeaker()
      UI:WaitShowDialogue("Something happened somewhere close...")
      SOUND:PlayBGM("Forsaken Desert.ogg", true)
    else
      GAME:WaitFrames(60)
      COMMON.CharSweatdrop("PLAYER")
      GAME:WaitFrames(20)
      UI:ResetSpeaker()
      UI:WaitShowDialogue("...nothing seemed to happen.")
    end
    choice = 0
  end
end

function DesertNW.InfoTablet_Action(obj, activator)
  UI:ResetSpeaker()
  UI:WaitShowDialogue("A few words this tablet holds.\nOne that flows before what grows.\nLast is one the second hates.\nAll can only be one.")
end

function DesertNW.WaterTablet_Action(obj, activator)
  UI:ResetSpeaker()
  UI:ChoiceMenuYesNo("There is a button on the symbol.[pause=50] Push it?", false)
  UI:WaitForChoice()
  local result = UI:ChoiceResult()
  if result then
    SOUND:PlayBattleSE("DUN_Octazooka")
    button_choice[choice] = 2
    check_answer()
    choice = choice + 1
  end
end

function DesertNW.GrassTablet_Action(obj, activator)
  UI:ResetSpeaker()
  UI:ChoiceMenuYesNo("There is a button on the symbol.[pause=50] Push it?", false)
  UI:WaitForChoice()
  local result = UI:ChoiceResult()
  if result then
    SOUND:PlayBattleSE("DUN_Octazooka")
    button_choice[choice] = 1
    check_answer()
    choice = choice + 1
  end
end

function DesertNW.FireTablet_Action(obj, activator)
  UI:ResetSpeaker()
  UI:ChoiceMenuYesNo("There is a button on the symbol.[pause=50] Push it?", false)
  UI:WaitForChoice()
  local result = UI:ChoiceResult()
  if result then
    SOUND:PlayBattleSE("DUN_Octazooka")
    button_choice[choice] = 3
    check_answer()
    choice = choice + 1
  end
end

-- Exits

function DesertNW.S_Touch(obj, activator)
  GAME:EnterGroundMap("DesertSW", "NorthEnter")
end

function DesertNW.SE_Touch(obj, activator)
  GAME:EnterGroundMap("DesertS", "NorthWestEnter")
end

function DesertNW.E_Touch(obj, activator)
  GAME:EnterGroundMap("DesertN", "WestEnter")
end

return DesertNW

