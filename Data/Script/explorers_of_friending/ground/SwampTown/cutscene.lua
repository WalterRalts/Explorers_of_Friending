SwampUp = {}

function SwampUp.TransferA()
    GROUND:Hide("PLAYER")
    local rexio = CH("PLAYER")
    local wurp = CH("Wurp")
    local snow = CH("Snow")
    local tidy = CH("Tidy")
    local flow = CH("Flow")
    local marsh = CH("Marshal")

    GROUND:Unhide("PLAYER")
    local coro01 = TASK:BranchCoroutine(function()
        local c1 = TASK:BranchCoroutine(function()
            GAME:FadeIn(50)
            end)	
        local c2 = TASK:BranchCoroutine(function()
            GAME:WaitFrames(25)
            GROUND:Unhide("PLAYER")
            GAME:WaitFrames(45)
            GROUND:Unhide("Snow")
            GAME:WaitFrames(25)
            GROUND:Unhide("Wurp")
            end)

        TASK:JoinCoroutines({c1, c2})
        end)	
    local coro02 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(20)
        UI:SetSpeaker(rexio)
        UI:SetSpeakerEmotion("Happy")
        UI:WaitShowDialogue("...looks like we made it!")
        end)
    TASK:JoinCoroutines({coro01, coro02})

    COMMON.FaceEachother(rexio, wurp)
    UI:SetSpeaker(wurp)
    UI:SetSpeakerEmotion("Sigh")
    UI:WaitShowDialogue("Phew-wew...![pause=20] T[emote=Worried]hat dungeon fet wike it took ages...!")

    UI:SetSpeaker(snow)
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowTimedDialogue("Wh-... where's T-tidy and...?")

    UI:ResetSpeaker()
    local q1 = TASK:BranchCoroutine(function()
        UI:WaitShowTimedDialogue("NONONONONONONONONONONONONONONONONONONO!", 20)
        UI:WaitShowTimedDialogue("NOOOOOOOOOOOOOOOO I DON'T WANT TO BE HERE STOP STOP STOP STOP STOP!", 20)
        UI:WaitShowTimedDialogue("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA!!!", 20)
        UI:WaitShowTimedDialogue("FLOW PLEEEEEEEASE, HAVE MERCYYYYYYYYYY!!!", 20)
        UI:WaitShowTimedDialogue("I'LL HELP YOU CLEAN YOUR FLOWER BACK AT HOME, I SWEAR!!!", 20)
        end)	
    local q2 = TASK:BranchCoroutine(function()
        local ac1 = TASK:BranchCoroutine(function()
            COMMON.CharExclaim("PLAYER")
            GAME:WaitFrames(7)
            GROUND:CharAnimateTurnTo(rexio, Dir8.Down, 2)
            end)	
        local ac2 = TASK:BranchCoroutine(function()
            GAME:WaitFrames(9)
            COMMON.CharRealize("Wurp")
            GAME:WaitFrames(12)
            GROUND:CharAnimateTurnTo(snow, Dir8.Down, 2)
            COMMON.CharRealizeHeavy("Snow")
            GROUND:CharAnimateTurnTo(wurp, Dir8.Down, 2)
            GAME:WaitFrames(3)
            end)

        TASK:JoinCoroutines({ac1, ac2})
        end)
    local q3 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(160)
        GROUND:CharAnimateTurnTo(flow, Dir8.Left, 2)
        GROUND:Unhide("Flow")
        UI:SetSpeaker(tidy)
        UI:SetSpeakerEmotion("Shouting")
        GROUND:Unhide("Tidy")
        GROUND:CharSetAction(tidy, RogueEssence.Ground.PoseGroundAction(tidy.Position, tidy.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Trip")))
        GROUND:AnimateToPosition(flow, "Walk", Dir8.Left, flow.Position.X + 10, flow.Position.Y, 0.2, 6, 0)
        end)

    TASK:JoinCoroutines({q1, q2, q3})
    local mover = true
    UI:SetSpeaker(flow)
    UI:SetSpeakerEmotion("Angry")
    UI:WaitShowDialogue("Tidy, come on! You've already been through the dungeon!")

    local lac1 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(50)
        GROUND:AnimateToPosition(flow, "Walk", Dir8.Left, flow.Position.X - 10, flow.Position.Y, 0.2, 6, 0)
        while mover == true do
            GROUND:CharSetEmote(flow, "sweating", 1)
            GAME:WaitFrames(50)
        end
        end)	
    local lac2 = TASK:BranchCoroutine(function()
        GROUND:AnimateToPosition(tidy, "Walk", Dir8.Left, tidy.Position.X - 10, tidy.Position.Y, 0.2, 6, 0)
        while mover == true do
            GROUND:AnimateToPosition(tidy, "Walk", Dir8.Left, flow.Position.X + 10, tidy.Position.Y, 8, 120, 0)
            GAME:WaitFrames(1)
        end
        end)
    local lac3 = TASK:BranchCoroutine(function()
        UI:SetSpeaker(tidy)
        UI:SetSpeakerEmotion("Shouting")
        UI:WaitShowDialogue("NOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO!")
        mover = false
        COMMON.CharSweatdrop("Wurp")
        end)
    TASK:JoinCoroutines({lac1, lac2, lac3})
    
    GROUND:AnimateToPosition(tidy, "Walk", Dir8.Left, tidy.Position.X, tidy.Position.Y, 4, 120, 0)
    GROUND:CharSetAnim(tidy, "None", false)

    GAME:WaitFrames(70)
    GROUND:CharSetAction(tidy, RogueEssence.Ground.PoseGroundAction(tidy.Position, tidy.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Trip")))
    GAME:WaitFrames(70)

    UI:SetSpeaker(snow)
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("W-... we'll go on ahead...")

    snow.CollisionDisabled = true
    wurp.CollisionDisabled = true
    
    

    local lac01 = TASK:BranchCoroutine(function()
        GROUND:MoveToMarker(snow, MRKR("m"), false, 3)
        GROUND:MoveToMarker(snow, MRKR("m_1"), false, 2)
        GROUND:MoveToMarker(snow, MRKR("m_2"), false, 3)
        GROUND:MoveToMarker(snow, MRKR("m_3"), false, 2)
        end)	
    local lac02 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(35)
        GROUND:MoveToMarker(wurp, MRKR("m"), false, 3)
        GROUND:MoveToMarker(wurp, MRKR("m_1"), false, 4)
        GROUND:MoveToMarker(wurp, MRKR("m_2"), false, 3)
        GROUND:MoveToMarker(wurp, MRKR("m_3"), false, 4)
        end)
    local lac03 = TASK:BranchCoroutine(function()
        GROUND:AnimateToPosition(flow, "Walk", Dir8.DownLeft, tidy.Position.X + 10, tidy.Position.Y - 8, 1, 1, 2)
        end)
    TASK:JoinCoroutines({lac01, lac02, lac03})
    GROUND:TeleportTo(wurp, 140, 150, Direction.DownLeft, 0)
    GROUND:TeleportTo(snow, 160, 170, Direction.DownLeft, 0)
    snow.CollisionDisabled = false
    wurp.CollisionDisabled = false
    GAME:RemovePlayerTeam(1)
    GAME:RemovePlayerTeam(1)
    GAME:RemovePlayerTeam(1)
    GAME:RemovePlayerTeam(1)
end



function SwampUp.TransferB()
    local rexio = CH("PLAYER")
    local wurp = CH("Wurp")
    local snow = CH("Snow")
    local tidy = CH("Tidy")
    local flow = CH("Flow")
    local zoomer = CH("Zoomer")
    local marsh = CH("Marshal")

    UI:SetSpeaker(STRINGS:Format("\\uE040"))
    UI:WaitShowDialogue("Awaaaaaay from the doorway!")
    SOUND:StopBGM()
    GROUND:AnimateToPosition(rexio, "Walk", Dir8.Up, zoomer.Position.X, rexio.Position.Y + 20, 1, 1, 0)
    GAME:WaitFrames(40)
    GROUND:Unhide("Zoomer")
    
    GAME:WaitFrames(40)
    UI:SetSpeaker(zoomer)
    UI:SetSpeakerEmotion("Stunned")
    UI:WaitShowDialogue("(Tch... another kid.)")
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Kid, you know anyone named Luke?")

    UI:SetSpeaker(rexio)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("That would be my dad, yes.")

    UI:SetSpeaker(zoomer)
    UI:SetSpeakerEmotion("Angry")
    UI:WaitShowDialogue("Whaaaaaaaaat?![pause=30] Another kid?![pause=30] Accepted?!")

    UI:SetSpeaker(rexio)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("Pssh, of course I was.")
    GROUND:CharAnimateTurnTo(rexio, Dir8.Down, 5)
    GROUND:CharSetAnim(rexio, "Charge", true)
    GROUND:CharSetAction(rexio, RogueEssence.Ground.PoseGroundAction(rexio.Position, rexio.Direction, RogueEssence.Content.GraphicsManager.GetAnimIndex("Charge")))

    COMMON.FaceEachother(wurp, rexio)
    GROUND:CharSetAnim(rexio, "None", false)
    
    UI:SetSpeaker(wurp)
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("Wexio, I thought you said wern't gon' weave.")
    UI:SetSpeakerEmotion("Pain")
    UI:WaitShowDialogue("The guiwd is pwobaby gon' keep you busy fow months...")

    UI:SetSpeaker(rexio)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("...nah, I'll get the work done.")

    UI:SetSpeaker(zoomer)
    UI:SetSpeakerEmotion("Stunned")
    UI:WaitShowDialogue("So you went with your little pals, then?[pause=25] Mm...")
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Marshal! Lead 'em back.")

    UI:SetSpeaker(marsh)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("You got it, boss.")
    GROUND:MoveToMarker(marsh, MRKR("m_4"), false, 4)

    COMMON.FaceEachother(snow, marsh)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Let's get at it, kiddos.")
    snow.CollisionDisabled = true
    wurp.CollisionDisabled = true
    
    local coro01 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(55)
        GROUND:MoveToMarker(marsh, MRKR("m_5"), false, 3)
        GROUND:MoveToMarker(marsh, MRKR("m_6"), false, 4)
        GROUND:MoveToMarker(marsh, MRKR("m_7"), false, 4)
        end)	
    local coro02 = TASK:BranchCoroutine(function()
        UI:SetSpeaker(snow)
        UI:SetSpeakerEmotion("Normal")
        UI:WaitShowTimedDialogue("Y-yes, sir...!", 60)

        GROUND:MoveToMarker(snow, MRKR("m_4"), false, 5)
        GROUND:MoveToMarker(snow, MRKR("m_5"), false, 4)
        GROUND:MoveToMarker(snow, MRKR("m_6"), false, 2)
        GROUND:MoveToMarker(snow, MRKR("m_7"), false, 2)
        end)
    local coro03 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(45)
        GROUND:MoveToMarker(wurp, MRKR("m_4"), false, 4)
        GROUND:MoveToMarker(wurp, MRKR("m_5"), false, 3)
        GROUND:MoveToMarker(wurp, MRKR("m_6"), false, 3)
        GROUND:MoveToMarker(wurp, MRKR("m_7"), false, 3)
        end)
    local coro04 = TASK:BranchCoroutine(function()
        GAME:WaitFrames(90)
        UI:SetSpeaker(zoomer)
        UI:SetSpeakerEmotion("Normal")
        UI:WaitShowDialogue("As for you,[pause=15] I guess you aren't too strong on your own...")
        COMMON.FaceEachother(rexio, zoomer)

        UI:SetSpeaker(rexio)
        UI:SetSpeakerEmotion("Angry")
        UI:WaitShowDialogue("Hey, I'm plenty strong! My friends just wanted to come with me!")

        UI:SetSpeaker(zoomer)
        UI:SetSpeakerEmotion("Normal")
        UI:WaitShowDialogue("Ha.")
        UI:SetSpeakerEmotion("Determined")
        UI:WaitShowDialogue("I'll help you to your guildleader, you'll need it.")
        end)
    TASK:JoinCoroutines({coro01, coro02, coro03, coro04})
    GROUND:Hide("Tidy")
    GROUND:Hide("Snow")
    GROUND:Hide("Marshal")
    GROUND:Hide("Wurp")
    GROUND:Hide("Flow")
    right_house = 7
    local mon_id = RogueEssence.Dungeon.MonsterID("zubat", 0, "normal", Gender.Male)

    local p = _DATA.Save.ActiveTeam:CreatePlayer(_DATA.Save.Rand, mon_id, 10, "", 0)
    p.IsFounder = false
    p.IsPartner = false
    p.Nickname = "Zoomer"

    _DATA.Save.ActiveTeam.Players:Add(p)
    _DATA.Save.ActiveTeam.Players[2]:RefreshTraits()
    local talk_npc = RogueEssence.Dungeon.BattleScriptEvent("ZoomerInteract")
          _DATA.Save.ActiveTeam.Players[2].ActionEvents:Add(talk_npc)
    COMMON.RespawnAllies()
    AI:SetCharacterAI(zoomer, "origin.ai.ground_partner", CH("PLAYER"), zoomer.Position)
    GROUND:Hide("Zoomer")    
end