--[[
    init.lua
    Created: 09/08/2024 11:07:18
    Description: Autogenerated script file for the map TarroForestPlaza.
]]--
-- Commonly included lua functions and data
require 'explorers_of_friending.common'

-- Package name
local TarroForestPlaza = {}

-------------------------------
-- Map Callbacks
-------------------------------
---TarroForestPlaza.Init(map)
--Engine callback function
function TarroForestPlaza.Init(map)
  MapStrings = STRINGS.MapStrings
  COMMON.RespawnAllies()
  local partner = CH('Teammate1')
  AI:SetCharacterAI(partner, "origin.ai.ground_partner", CH('PLAYER'), partner.Position)
  partner.CollisionDisabled = true

  COMMON.CreateWalkArea("Catering", 48, 264, 72, 72)
end

---TarroForestPlaza.Enter(map)
--Engine callback function
function TarroForestPlaza.Enter(map)

  GAME:FadeIn(20)

end

---TarroForestPlaza.Exit(map)
--Engine callback function
function TarroForestPlaza.Exit(map)

  

end

---TarroForestPlaza.Update(map)
--Engine callback function
function TarroForestPlaza.Update(map)

  local maru = CH("PLAYER")
  local azura = CH('Teammate1')

  if GAME:IsKeyDown(66) then
    print("Partner")
  end
  if GAME:IsKeyDown(66) then
    UI:SetSpeaker(azura)
    GROUND:CharTurnToCharAnimated(maru, azura, 4)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("[speed=0.04]...h[speed=0.6][emote=Worried]mmm.")

    UI:SetSpeaker(maru)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("What's up?")

    UI:SetSpeaker(azura)
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("Well...[pause=0] it's just kinda weird.")
    UI:WaitShowDialogue("They just wanna leave the place they were born in.")

    UI:SetSpeaker(maru)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Well, yeah. [pause=35]There isn't much to do in here.")
      
    UI:SetSpeaker(azura)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("I guess so. [pause=30]I'd miss this place if I were them, though.")
  end
end

---TarroForestPlaza.GameSave(map)
--Engine callback function
function TarroForestPlaza.GameSave(map)


end

---TarroForestPlaza.GameLoad(map)
--Engine callback function
function TarroForestPlaza.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------
function TarroForestPlaza.Catering_Action(obj, activator)
  local cater = CH("Catering")
  local maru = CH("PLAYER")

  GROUND:CharTurnToCharAnimated(cater, maru, 4)
  UI:SetSpeaker(cater)
  UI:SetSpeakerEmotion("Inspired")
  UI:WaitShowDialogue("Oh, man, I can't wait to get out of here!")
  UI:WaitShowDialogue("It's gonna be fun not walking around that boring dungeon!")
  UI:SetSpeakerEmotion("Joyous")
  UI:WaitShowDialogue("And I get have fun with others, too!")
end

function TarroForestPlaza.TFPlaza_Exit_Touch(obj, activator)
  outside_enter = 1
  GAME:FadeOut(false, 15)
  GAME:EnterGroundMap("TarroForestPassage", "TFPassage_PlazaExit")
end

function TarroForestPlaza.Caterpie_Action(obj, activator)
  local butterboss = CH("Butterfree")
  local bug1 = CH("Caterpie")
  local bug2 = CH("Metapod")
  local bug3 = CH("Caterpie_1")
  local bug4 = CH("Kakuna")
  local bug5 = CH("Weedle")

  if SV.tarro_forest.caterpie_name == "a25ee5" then
    UI:SetSpeaker(butterboss)
    UI:SetSpeakerEmotion("Determined")
    UI:WaitShowDialogue("Now, before I let you all off on your own!")
    UI:WaitShowDialogue("Each one of ye needs a name!")
    COMMON.FaceEachother("Butterfree", "Weedle")
    GAME:WaitFrames(35)
    COMMON.FaceEachother("Butterfree", "Caterpie")
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("You![pause=25] Little one![pause=0] Gimme a name for yourself!")

    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Stunned")
    UI:WaitShowDialogue("[speed=0.6]U-uh... uh...!")
    bug1.Data.Nickname = "Uh..."
    COMMON.FaceEachother("PLAYER", "Caterpie")
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("H-help.")

    UI:NameMenu("What nickname should be given to this Caterpie?", "", 200, "Catbug")
    UI:WaitForChoice() 
    print(UI:ChoiceResult())
    SV.tarro_forest.caterpie_name = UI:ChoiceResult()

    COMMON.FaceEachother("Butterfree", "Caterpie")
    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("[speed=0.6]Thank you...!")

    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Joyous")
    UI:WaitShowDialogue("I'll call myself " ..SV.tarro_forest.caterpie_name.. "!")
    bug1.Data.Nickname = SV.tarro_forest.caterpie_name

    UI:SetSpeaker(butterboss)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("Good good!")
    UI:SetSpeakerEmotion("Determined")
    UI:WaitShowDialogue("Now all of you bugs will learn about manners!")

    COMMON.FaceEachother("PLAYER", "Caterpie")
    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Inspired")
    UI:WaitShowDialogue("Thank you...!")

    COMMON.FaceEachother("Butterfree", "Caterpie")
    COMMON.FaceEachother("Butterfree", "Caterpie_1")
  else
    bug1.Data.Nickname = SV.tarro_forest.caterpie_name
    COMMON.FaceEachother("PLAYER", "Caterpie")
    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Inspired")
    UI:WaitShowDialogue("Thank you...!")

    COMMON.FaceEachother("Butterfree", "Caterpie")
    COMMON.FaceEachother("Butterfree", "Caterpie_1")
  end
  
end


return TarroForestPlaza

