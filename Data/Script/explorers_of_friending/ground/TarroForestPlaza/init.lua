--[[
    init.lua
    Created: 09/08/2024 11:07:18
    Description: Autogenerated script file for the map TarroForestPlaza.
]]--
-- Commonly included lua functions and data
require 'explorers_of_friending.common'

-- Package name
local TarroForestPlaza = {}

-------------------------------
-- Map Callbacks
-------------------------------
---TarroForestPlaza.Init(map)
--Engine callback function
function TarroForestPlaza.Init(map)
  MapStrings = STRINGS.MapStrings
  COMMON.RespawnAllies()
  local partner = CH('Teammate1')
  AI:SetCharacterAI(partner, "origin.ai.ground_partner", CH('PLAYER'), partner.Position)
  partner.CollisionDisabled = true

  COMMON.CreateWalkArea("Catering", 48, 264, 72, 72)
end

---TarroForestPlaza.Enter(map)
--Engine callback function
function TarroForestPlaza.Enter(map)

  GAME:FadeIn(20)

end

---TarroForestPlaza.Exit(map)
--Engine callback function
function TarroForestPlaza.Exit(map)

  

end

---TarroForestPlaza.Update(map)
--Engine callback function
function TarroForestPlaza.Update(map)
  Partner()
end

---TarroForestPlaza.GameSave(map)
--Engine callback function
function TarroForestPlaza.GameSave(map)


end

---TarroForestPlaza.GameLoad(map)
--Engine callback function
function TarroForestPlaza.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------
function TarroForestPlaza.Catering_Action(obj, activator)
  local cater = CH("Catering")
  local maru = CH("PLAYER")

  GROUND:CharTurnToCharAnimated(cater, maru, 4)
  UI:SetSpeaker(cater)
  UI:SetSpeakerEmotion("Inspired")
  UI:WaitShowDialogue("Oh, man, I can't wait to get out of here!")
  UI:WaitShowDialogue("It's gonna be fun not walking around that boring dungeon!")
  UI:SetSpeakerEmotion("Joyous")
  UI:WaitShowDialogue("And I get have fun with others, too!")
end

function TarroForestPlaza.TFPlaza_Exit_Touch(obj, activator)
  OutEnter = 1
  GAME:FadeOut(false, 15)
  GAME:EnterGroundMap("TarroForestPassage", "TFPassage_PlazaExit")
end

function TarroForestPlaza.Caterpie_Action(obj, activator)
  local butterboss = CH("Butterfree")
  local bug1 = CH("Caterpie")
  local bug2 = CH("Metapod")
  local bug3 = CH("Caterpie_1")
  local bug4 = CH("Kakuna")
  local bug5 = CH("Weedle")

  if SV.tarro_forest.caterpie_name == "a25ee5" then
    UI:SetSpeaker(butterboss)
    UI:SetSpeakerEmotion("Determined")
    UI:WaitShowDialogue("Now, before I let you all off on your own!")
    UI:WaitShowDialogue("Each one of ye needs a name!")
    COMMON.FaceEachother(butterboss, bug5)
    GAME:WaitFrames(35)
    COMMON.FaceEachother(butterboss, bug1)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("You![pause=25] Little one![pause=0] Name yourself!")

    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Stunned")
    UI:WaitShowDialogue("[speed=0.6]U-uh... uh...!")
    bug1.Data.Nickname = "Uh..."
    COMMON.FaceEachother(activator, bug1)
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("H-help.")

    UI:NameMenu("What nickname should be given to this Caterpie?", "", 200, "Catbug")
    UI:WaitForChoice() 
    print(UI:ChoiceResult())
    SV.tarro_forest.caterpie_name = UI:ChoiceResult()

    COMMON.FaceEachother(butterboss, bug1)
    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("[speed=0.6]Thank you...!")

    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Joyous")
    UI:WaitShowDialogue("I'll call myself " ..SV.tarro_forest.caterpie_name.. "!")
    bug1.Data.Nickname = SV.tarro_forest.caterpie_name

    UI:SetSpeaker(butterboss)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("Good good!")
    UI:SetSpeakerEmotion("Determined")
    UI:WaitShowDialogue("Now a lesson in manners!")

    COMMON.FaceEachother(activator, bug1)
    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Inspired")
    UI:WaitShowDialogue("Thank you...!")

    COMMON.FaceEachother(butterboss, bug1)
    COMMON.FaceEachother(butterboss, bug3)
  else
    bug1.Data.Nickname = SV.tarro_forest.caterpie_name
    COMMON.FaceEachother(activator, bug1)
    UI:SetSpeaker(bug1)
    UI:SetSpeakerEmotion("Inspired")
    UI:WaitShowDialogue("Thank you...!")

    COMMON.FaceEachother(butterboss, bug1)
    COMMON.FaceEachother(butterboss, bug3)
  end
end

function TarroForestPlaza.Butterfree_Action(obj, activator)
  local butterboss = CH("Butterfree")

  COMMON.FaceEachother(activator, butterboss)
  UI:SetSpeaker(butterboss)
  UI:SetSpeakerEmotion("Determined")
  UI:WaitShowDialogue("Bug business! Out of the way!")
end

function TarroForestPlaza.Metapod_Action(obj, activator)
  TarroForestPlaza.Butterfree_Action()
end

function TarroForestPlaza.Kakuna_Action(obj, activator)
  TarroForestPlaza.Butterfree_Action()
end

function TarroForestPlaza.Caterpie_1_Action(obj, activator)
  TarroForestPlaza.Butterfree_Action()
end

function TarroForestPlaza.Weedle_Action(obj, activator)
  local bug5 = CH("Weedle")

  UI:SetSpeaker(bug5)
  UI:SetSpeakerEmotion("Worried")
  UI:WaitShowDialogue("...this class is so boring.")
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowDialogue("Can't I just leave?[pause=20] I just wanna leave.")
end

return TarroForestPlaza

