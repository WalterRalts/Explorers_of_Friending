--[[
    init.lua
    Created: 09/20/2025 00:02:59
    Description: Autogenerated script file for the map DragonDelivery.
]]--
-- Commonly included lua functions and data
require 'explorers_of_friending.common'

-- Package name
local DragonDelivery = {}

local Coro = function()
  local willow = CH("Willow")
  local will_move = math.random(100, 200)
  local will_sweat = math.random(25, 150)
  local coro01 = TASK:BranchCoroutine(function()
    GROUND:MoveToMarker(willow, MRKR("willmove"), false, 1)
    GROUND:CharAnimateTurnTo(willow, Dir8.UpRight, 2)
    GAME:WaitFrames(will_move)

    GROUND:MoveToMarker(willow, MRKR("willmove_1"), false, 1)
    GROUND:CharAnimateTurnTo(willow, Dir8.UpRight, 2)
    GAME:WaitFrames(will_move)
    end)	
  local coro02 = TASK:BranchCoroutine(function()
    GAME:WaitFrames(will_sweat)
    GROUND:CharSetEmote(CH("Willow"), "sweating", 1)
    end)
  TASK:JoinCoroutines({coro01, coro02})
end

-------------------------------
-- Map Callbacks
-------------------------------
---DragonDelivery.Init(map)
--Engine callback function
function DragonDelivery.Init(map)
  
end

---DragonDelivery.Enter(map)
--Engine callback function
function DragonDelivery.Enter(map)

  
  GAME:FadeIn(20)

end

---DragonDelivery.Exit(map)
--Engine callback function
function DragonDelivery.Exit(map)


end

---DragonDelivery.Update(map)
--Engine callback function
function DragonDelivery.Update(map)
  TASK:StartEntityTask(CH("Willow"), Coro)
end

---DragonDelivery.GameSave(map)
--Engine callback function
function DragonDelivery.GameSave(map)


end

---DragonDelivery.GameLoad(map)
--Engine callback function
function DragonDelivery.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------
know_willow = false
dragon_talk = 0

function DragonDelivery.Willow_Action(obj, activator)
  if know_willow == true then
    obj.Data.Nickname = "Willow"
  else
    obj.Data.Nickname = "???"
  end
  COMMON.FaceEachother(obj, activator)
  UI:SetSpeaker(obj)
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowDialogue("I'm glad I got a job,[pause=40] but[emote=Worried] I was enjoying myself back home...")
end

function DragonDelivery.Chucky_Action(obj, activator)
  COMMON.FaceEachother(obj, activator)
  UI:SetSpeaker(obj)
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowDialogue("The new gal is really helpful.[pause=50] No[emote=Worried] idea why Dragon dragged her out of a dungeon to help but...")
end

function DragonDelivery.Delivery_Action(obj, activator)
  local dragon = CH("Dragon")

  if dragon_talk == 0 then
    UI:SetSpeaker(dragon)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Hey, Rexio![pause=40] Fun seeing ya,[pause=20] did your dad forget a package again?")

    UI:SetSpeaker(activator)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("Not this time.")

    UI:SetSpeaker(dragon)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Oh, and uh, sorry about what you saw days ago.")
    UI:WaitShowDialogue("Your packages won't be late,[pause=30] Pelipper[emote=Happy] taught me a thing or three.")

    UI:SetSpeaker(activator)
    GROUND:CharAnimateTurnTo(activator, Dir8.Left, 3)
    UI:SetSpeakerEmotion("Stunned")
    UI:WaitShowDialogue("Doesn't look like they helped you organize, though...")

    UI:SetSpeaker(dragon)
    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("I could do it,[pause=30] but I'm not really feelin' it.")
    dragon_talk = 1
  else
    know_willow = true
    UI:SetSpeaker(dragon)
    UI:SetSpeakerEmotion("Happy")
    UI:WaitShowDialogue("Have ya met Willow yet? She's really good at movin' stuff around for Chucky.")
  end
end

function DragonDelivery.RexioExit_Touch(obj, activator)
  GAME:FadeOut(false, 20)
  GAME:EnterGroundMap("EntohTownDelivery", "DragonExit")
end

return DragonDelivery

