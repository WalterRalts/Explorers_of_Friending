--[[
    init.lua
    Created: 08/25/2024 12:46:21
    Description: Autogenerated script file for the map MaruHome.
]]--
-- Commonly included lua functions and data
require 'origin.common'

-- Package name
local MaruHome = {}

-------------------------------
-- Map Callbacks
-------------------------------
---MaruHome.Init(map)
--Engine callback function
function MaruHome.Init(map)
  if chapterpie <= 1 then
    chapterpie = 2
  end
  MapStrings = STRINGS.MapStrings
  COMMON.RespawnAllies()
  local partner = CH('Teammate1')
  AI:SetCharacterAI(partner, "origin.ai.ground_partner", CH('PLAYER'), partner.Position)
  partner.CollisionDisabled = true
end

---MaruHome.Enter(map)
--Engine callback function
function MaruHome.Enter(map)

  GAME:FadeIn(20)

end

---MaruHome.Exit(map)
--Engine callback function
function MaruHome.Exit(map)


end

---MaruHome.Update(map)
--Engine callback function
function MaruHome.Update(map)

  local maru = CH("PLAYER")
  local azura = CH('Teammate1')

  if GAME:IsKeyDown(66) then
    print("Partner")
  end
  if GAME:IsKeyDown(66) then
    if chapterpie == 2 then
      UI:SetSpeaker(azura)
      GROUND:CharTurnToCharAnimated(maru, azura, 4)
      UI:SetSpeakerEmotion("Happy")
      UI:WaitShowDialogue("Let's go find that big apple!")

      UI:SetSpeaker(maru)
      UI:SetSpeakerEmotion("Normal")
      UI:WaitShowDialogue("That's the new plan.")
    else
      UI:SetSpeaker(azura)
      GROUND:CharTurnToCharAnimated(maru, azura, 4)
      UI:SetSpeakerEmotion("Inspired")
      UI:WaitShowDialogue("Yay! Home!")
    end
  end
end

---MaruHome.GameSave(map)
--Engine callback function
function MaruHome.GameSave(map)


end

---MaruHome.GameLoad(map)
--Engine callback function
function MaruHome.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------
function MaruHome.MaruOven_Action(obj, activator)
  local maru = CH("PLAYER")

  if chapterpie <= 5 then
    UI:SetSpeaker(maru)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("This is what mom uses to cook with...")

    UI:SetSpeakerEmotion("Worried")
    UI:WaitShowDialogue("Though[pause=25], I should probably ask her for permission use it first...")
  end
end

function MaruHome.Arama_Action(obj, activator)
  local maru = CH("PLAYER")
  local arama = CH("Arama")

  UI:SetSpeaker(arama)
  UI:SetSpeakerEmotion("Worried")
  UI:WaitShowDialogue("Okay, I know that you two are well-taught for this, but...")
  UI:WaitShowDialogue("Please,[pause=20] take your time. No rushing.")

  UI:SetSpeaker(maru)
  UI:SetSpeakerEmotion("Happy")
  UI:WaitShowDialogue("We'll be fine, mom, promise!")
end

function MaruHome.Amazuru_Action(obj, activator)
  local maru = CH("PLAYER")
  local amazuru = CH("Amazuru")
  local azura = CH("Teammate1")

  UI:SetSpeaker(amazuru)
  UI:SetSpeakerEmotion("Normal")
  UI:WaitShowDialogue("Honestly, you two will be fine in there.")
  UI:WaitShowDialogue("Just try not to[pause=30] b[emote=Happy]ug[pause=30] t[emote=Normal]he locals.")

  GAME:WaitFrames(30)

  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Stunned")
  UI:WaitShowDialogue("Wha-... was that a joke?")

  UI:SetSpeaker(amazuru)
  UI:SetSpeakerEmotion("Happy")
  UI:WaitShowDialogue("Yep.")

  UI:SetSpeaker(azura)
  UI:SetSpeakerEmotion("Stunned")
  UI:WaitShowDialogue("[speed=0.05]...[speed=1.0][emote=Determined]booooooo.")
end

function MaruHome.MaruHome_BasementEntrance_Touch(obj, activator)
  local maru = CH("PLAYER")
  local azura = CH("Teammate1")

  if chapterpie <= 5 then
    UI:SetSpeaker(azura)
    UI:SetSpeakerEmotion("Angry")
    UI:WaitShowDialogue("Maru,[pause=35] apple!")
    
    UI:SetSpeaker(maru)
    UI:SetSpeakerEmotion("Normal")
    UI:WaitShowDialogue("Oh,[pause=15] yes,[pause=15] apple,[pause=15] yep.")
  end
end

function MaruHome.MaruHome_Exit_Touch(obj, activator)
  outside_enter = 1
  GAME:FadeOut(false, 20)
  GAME:EnterGroundMap("TarroTownEast", "TTEast_MaruHomeEnter")
end

return MaruHome

